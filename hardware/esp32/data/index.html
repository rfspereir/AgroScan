<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configuração AgroScan</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 500px; margin: auto; padding: 20px; }
    h2 { text-align: center; }
    input, button { width: 100%; padding: 10px; margin: 6px 0; box-sizing: border-box; }
    label { font-weight: bold; display: block; margin-top: 12px; }
    button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #45a049; }
    .card { padding: 20px; border-radius: 8px; border: 1px solid #ccc; background: #f9f9f9; }
    footer { text-align: center; margin-top: 20px; color: #888; font-size: 14px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Configuração AgroScan</h2>

    <form id="form">
      <!-- Campos de configuração manual -->
      <label>Wi-Fi SSID</label>
      <input name="wifiSSID" placeholder="Nome da Rede Wi-Fi" required>

      <label>Wi-Fi Senha</label>
      <input name="wifiPassword" type="password" placeholder="Senha do Wi-Fi" required>

      <label>API Key Firebase</label>
      <input name="apiKey" placeholder="API Key do Firebase" required>

      <label>Database URL</label>
      <input name="databaseURL" placeholder="https://xxx.firebaseio.com" required>

      <label>Storage Bucket</label>
      <input name="storageBucket" placeholder="xxx.appspot.com" required>

      <label>Cliente ID</label>
      <input name="clienteId" placeholder="UID do Cliente no sistema" required>

      <label>Dispositivo UID</label>
      <input name="dispositivoUID" placeholder="UID do Dispositivo no sistema" required>

      <label>Número de Série (SN)</label>
      <input name="sn" placeholder="Número de Série (Opcional)">

      <label>MAC Address</label>
      <input name="mac" placeholder="MAC Address (Opcional)">

      <button type="submit">Salvar e Reiniciar</button>
    </form>

    <hr>

    <h3>Ou carregar um arquivo config.json pronto:</h3>
    <input type="file" id="jsonFile" accept=".json" />
    <button onclick="uploadJson()">Upload JSON e Reiniciar</button>
  </div>

  <footer>
    AgroScan &copy; 2025
  </footer>

  <script>
    const form = document.getElementById('form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      const res = await fetch('/save', {
        method: 'POST',
        body: JSON.stringify(data)
      });
      if (res.ok) {
        alert('✅ Configuração salva! Reiniciando...');
      } else {
        alert('❌ Erro ao salvar configuração.');
      }
    });

    async function uploadJson() {
      const fileInput = document.getElementById('jsonFile');
      const file = fileInput.files[0];
      if (!file) {
        alert('Por favor, selecione um arquivo JSON.');
        return;
      }
      const text = await file.text();
      const res = await fetch('/save', {
        method: 'POST',
        body: text
      });
      if (res.ok) {
        alert('✅ Configuração salva via JSON! Reiniciando...');
      } else {
        alert('❌ Erro ao salvar configuração via JSON.');
      }
    }
  </script>
</body>
</html>
